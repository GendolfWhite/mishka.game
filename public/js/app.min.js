(()=>{"use strict";const t={set:function(t,e,s={}){null!=(s={path:"/",...s}).day?s.expires=new Date(Date.now()+24*s.day*60*60*1e3).toUTCString():s.expires instanceof Date&&(s.expires=s.expires.toUTCString());let i=encodeURIComponent(t)+"="+encodeURIComponent(e);for(let t in s){i+="; "+t;let e=s[t];!0!==e&&(i+="="+e)}document.cookie=i},remove:function(t){this.set(t,"",{"max-age":-1})},get:function(t){let e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return e?decodeURIComponent(e[1]):void 0},list:function(){let t={};for(let e of document.cookie.split("; "))e=e.split("="),t[e[0]]=e[1];return t}};var e,s;e=function(t){1==t?document.querySelector("body").classList.add("webp"):document.querySelector("body").classList.add("no-webp")},(s=new Image).onload=s.onerror=function(){e(2==s.height)},s.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA","serviceWorker"in navigator&&self.addEventListener("load",(async()=>{const t=navigator.serviceWorker;null===t.controller&&await t.register("./js/sw.js")}));const i=t;let n=!1;const a=!(window.outerWidth>768),r=(t=!1)=>{a&&(document.querySelector("body").style.maxHeight=t?"":window.innerHeight+"px",document.querySelector("body").style.minHeight=t?"":window.innerHeight+"px",document.querySelector("body").style.height=t?"":window.innerHeight+"px")};window.addEventListener("resize",(()=>{r()}));const o=()=>{let t=document.querySelector(".startBox--show"),e=document.querySelector(".startBox--hide");t.classList.toggle("startBox--hide"),t.classList.toggle("startBox--show"),setTimeout((()=>{e.classList.toggle("startBox--absolute"),e.classList.toggle("startBox--hide"),e.classList.toggle("startBox--show"),t.classList.toggle("startBox--absolute")}),400)};window.addEventListener("load",(()=>{r();for(const t of document.querySelectorAll(".startBox__toggler"))t.addEventListener("click",(t=>{t.preventDefault(),o()}));(()=>{const t=document.querySelector(".Preloader");setTimeout((()=>{setTimeout((()=>{t.classList.add("Preloader--loaded")}),n?1:500)}),n?1:500)})();for(const t of document.querySelectorAll(".HeadSocs__link, .Footer__link"))t.addEventListener("click",(function(t){t.preventDefault(),window.location.href=this.getAttribute("data-href"),setTimeout((()=>{window.location.href=this.getAttribute("href")}),100)}));class t{#t=null;#e={};constructor(t=!0,e={}){this.#s(),this.hide(),t&&(this.#i(e),this.#n())}#s(){this.#t=document.createElement("table"),this.#t.classList.add("Stats"),this.#t.setAttribute("id","adminTable"),this.#t.innerHTML="<thead><tr><th>#</th><th>name</th><th>gen</th><th>count</th><th>proportion</th></tr></thead><tbody></tbody><tfoot></tfoot>",document.querySelector("[data-game-panel='results']").after(this.#t)}#i(t){this.#e=t}#n(){for(const t in this.#e.typeProportion)this.#t.querySelector("tbody").append(this.#a(t,t));this.#t.querySelector("tfoot").append(this.#a("itemCount","itemCount",!1)),this.#t.querySelector("tfoot").append(this.#a("itemGennerate","itemGennerate",!1))}#r(t=!1,e=!1,s=!1){let i=document.createElement("td");return t&&(i.innerText=t),e&&i.setAttribute("id",e),s&&i.setAttribute("colspan",s),i}#a(t,e,s=!0){let i=document.createElement("tr");return i.append(this.#r()),i.append(this.#r(t,!1,!s&&2)),s?(i.append(this.#r(!1,e+"_gen")),i.append(this.#r(!1,e+"_count")),i.append(this.#r(!1,e+"_proportion"))):i.append(this.#r(!1,e,!s&&2)),i}#o(t,e){this.#t.querySelector(`#${t}`).innerText=e}draw(t){if(n){this.#i(t),this.show(),this.#o("itemCount",this.#e.itemCount),this.#o("itemGennerate",this.#e.itemGennerate);for(const t in this.#e.typeProportion)this.#o(`${t}_gen`,this.#e.typeCount[t].gennerate),this.#o(`${t}_count`,this.#e.typeCount[t].current),this.#o(`${t}_proportion`,this.#e.typeProportion[t])}else this.hide()}hide(){this.#t.hidden=1}show(){this.#t.hidden=0}}class e{#l=null;#h=[];#d=0;#c=0;#m={};#u={};constructor(e){this.#h=e,this.#p(),this.table=new t(1,this.#y())}#y(){return{itemGennerate:this.#d,itemCount:this.#c,typeProportion:this.#m,typeCount:this.#u}}#g(t){this.#l=t}#p(){for(const t of this.#h)this.#m[t]=0,this.#u[t]={gennerate:0,current:0}}#T(t,e){return(100*e/t).toFixed(2)}typeProportion(t){return this.#T(this.#d,this.#u[t].gennerate+1)}getItemCount(){return this.#c}#I(){this.#c=0;for(const t in this.#u)this.#c+=this.#u[t].current}#f(t){this.#m[this.#l]=t}#C(t=!1){this.#u[this.#l].current=t||this.#u[this.#l].current+1,this.#f(this.#T(this.#d,this.#u[this.#l].gennerate)),t?this.#I():this.#c++}setCount(t,e){this.#g(t),this.#C(e)}minusCount(){this.#c--}#S(){this.#u[this.#l].gennerate++,this.#d++}addStat(t){this.#g(t),this.#C(!1),this.#S(),this.table.draw(this.#y())}clearStats(t=!1){t&&(this.#d=0),this.#c=0,this.#m={},this.#u={},this.#p(),this.table.hide()}}class s{#b=null;#v=[];#w=null;#A=null;#k=1.5;#L=2.5;#P=[4,11,13];#x=[];#q={cocktail:{name:"Виски-кола",specimen:null,className:"cocktail",addBonus:!0},shot:{name:"Лимончело",specimen:null,className:"shot",addBonus:!0},nybear:{name:"Медведь в новогодней шапке",specimen:null,className:"nybear",addBonus:!0,count:3},balls:{name:"Ёлочные шары",specimen:null,className:"balls",addBonus:!0,count:4},tree:{name:"Ёлка",specimen:null,className:"tree",addBonus:!0},pizza:{name:"Пицца",specimen:null,className:"pizza",addBonus:!0,count:2},sticker:{name:"Стикеры из телеги",specimen:null,className:"sticker",addBonus:!1,count:16}};constructor(){this.#B()}#R(t){this.#x.push(t)}#B(){for(const t in this.#q)this.#E(this.#q[t]),this.#R(t),this.#D(),this.#M(),this.#q[t].specimen=this.#G(),void 0!==this.#q[t].count&&(this.#q[t].specimen=this.#N())}#_(){this.#v=[]}#F(t){this.#v.push(t)}#V(){for(let t=1;t<=this.#w.count;t++)this.#$(this.#w.specimen.cloneNode()),this.#H(t),this.#F(this.#G())}#N(){return this.#_(),this.#V(),this.#v}#D(){this.#b=document.createElement("div")}#$(t){this.#b=t}#E(t){this.#w=t}#H(t){this.#b.classList.add("GameItem--"+this.#w.className+"--"+t),"sticker"==this.#w.className&&this.#P.includes(t)&&this.#b.classList.add("bonus","sticker")}#M(){this.#b.setAttribute("data-type",this.#w.className),this.#b.classList.add("GameItem"),this.#b.classList.add("GameItem--"+this.#w.className),!0===this.#w.addBonus&&this.#b.classList.add("bonus"),this.#b.classList.add("new")}#G(){return this.#b}#z(t,e,s=!1){return s?Math.random()*(e-t)+t:Math.floor(Math.random()*(e-t)+t)}#U(){this.#b.style.top=this.#z(0,100)+"%",this.#b.style.left=this.#z(0,100)+"%"}#O(){this.#b.style.transform=`translate(-50%, -50%) rotate(${this.#z(0,359)}deg) scale(${this.#z(this.#k,this.#L,1)})`}#j(){this.#U(),this.#O()}#W(t){this.#A=t||this.getRandType()}#J(){return this.#q[this.#A].specimen[this.#z(0,this.#q[this.#A].specimen.length-1)]}#Q(){this.#$((Array.isArray(this.#q[this.#A].specimen)?this.#J():this.#q[this.#A].specimen).cloneNode(!0))}getTypes(){return this.#x}getRandType(){return this.#x[this.#z(0,this.#x.length)]}getItem(t=!1){return this.#W(t),this.#Q(),this.#j(),this.#G()}}class l{#X=null;#Y=null;#K=null;constructor(t,e){this.#K=t,this.#Y=e}async#Z(){let t=null;try{t=await fetch("https://gfwe.ru/mishkabar/game/")}catch(t){alert("Ошибка при загрузке")}let e=await t.json();this.#X=e,this.#tt()}load(){this.#Z()}async save(){const t=new FormData(this.#Y);i.set("score",t.get("score")),i.set("instagram",t.get("instagram")),this.#Y.reset();let e=null;try{e=await fetch("https://gfwe.ru/mishkabar/game/",{method:"POST",body:t})}catch(t){alert("Ошибка при загрузке")}let s=await e.json();console.log(s),s.status?this.#Z():alert("Произошла ошибка при сохранении: (")}#et(t=""){let e=document.createElement("td");return e.innerText=t,e}#st(t,e,s,n){let a=document.createElement("tr");return i.get("instagram")==s&&a.classList.add("you"),a.setAttribute("data-id",t),a.setAttribute("data-date",e),a.append(this.#et()),a.append(this.#et(s)),a.append(this.#et(n)),a}#it(){this.#K.innerHTML=""}#tt(){this.#it();for(const t of this.#X)this.#K.append(this.#st(t.id,t.date,t.instagram,t.score))}}new class{play=!1;#b=null;#nt=null;#at=null;#rt={};#ot={autoAdd:null,autoClear:null,timer:null,autoClick:null};#lt=10;#ht=!0;#dt=5;#ct=15;#mt=1;#ut=15;#pt=300;#yt=2;#gt=60;#Tt=0;#It=0;#ft={cocktail:15,shot:15,nybear:15,balls:15,tree:15,pizza:15,sticker:50};constructor(t=!1){t&&(this.#gt=t),this.#Ct(),this.#St(),this.#b=new s,this.#nt=new e(this.#b.getTypes()),this.#at=new l(this.#rt.tbody,this.#rt.form)}#Ct(){for(const t of document.querySelectorAll("[data-game-panel]"))this.#rt[t.getAttribute("data-game-panel")]=t}start(){this.#bt(),this.#vt(),this.#wt({bttns:0,timer:1,info:1,field:1,start:0,end:0}),this.#At(!0),this.#kt(),this.#Lt(),this.#Pt(),this.play=!this.play}stop(){this.#xt(),this.#bt(),this.#wt({bttns:1,timer:0,info:0,field:0,start:0,bttnSave:1,bttnStart:0,bttnRestart:1}),this.#nt.clearStats(1),this.#qt(),this.#wt({end:1}),this.play=!this.play}#St(){this.#rt.bttnRestart.addEventListener("click",(t=>{t.preventDefault(),this.start()})),this.#rt.bttnStart.addEventListener("click",(t=>{t.preventDefault(),this.start(),a&&(document.fullscreenElement?document.exitFullscreen():(r(1),document.documentElement.requestFullscreen()))})),this.#rt.field.addEventListener("click",(t=>{t.isTrusted&&this.#Bt(t.target),this.#Rt()})),this.#rt.form.addEventListener("submit",(t=>{t.preventDefault(),this.#at.save(),this.#at.load(),this.#wt({start:1,end:0,bttnSave:0,bttnRestart:0,bttnStart:1,results:1})})),this.#rt.bttnResults.addEventListener("click",(t=>{t.preventDefault(),this.#at.load(),this.#wt({results:1})})),this.#rt.results.querySelector(".Bttn").addEventListener("click",(t=>{t.preventDefault(),this.#wt({results:0})})),window.addEventListener("keypress",(t=>{console.log(t.keyCode),116==t.keyCode&&(n=!n),99==t.keyCode&&console.log(i.list()),115==t.keyCode&&(this.play?this.stop():this.start())}))}#z(t,e,s=!1){return s?Math.random()*(e-t)+t:Math.floor(Math.random()*(e-t)+t)}#Et(t,e){return e>=this.#ft[t]}#Dt(){let t=!1;if(this.#ut>this.#nt.getItemCount())t=this.#b.getRandType();else for(;!1===t;){t=this.#b.getRandType();let e=this.#nt.typeProportion(t);this.#Et(t,e)&&(t=!1)}return this.#nt.addStat(t),t}#Mt(){return this.#b.getItem(this.#Dt())}#Gt(){let t=this.#pt/2;for(const e of this.#rt.field.querySelectorAll("*"))t>0&&(e.classList.add("old"),this.#nt.minusCount(),this.#Bt(e,!0)),t--}#At(t=!1){for(let e=t?this.#ut:this.#ht?this.#z(this.#dt,this.#ct):this.#lt;e>0;e--){let t=this.#Mt();setTimeout((()=>{this.#rt.field.append(t),setTimeout((()=>{t.classList.remove("new")}),50),this.#pt<this.#nt.getItemCount()&&this.#Gt()}),this.#z(150,1500))}}#bt(){for(const t of this.#rt.field.querySelectorAll("*"))t.remove()}#Lt(){this.#ot.autoAdd=setInterval((()=>{this.#At()}),1e3*this.#mt)}#Pt(){this.#ot.autoClear=setInterval((()=>{for(const t of this.#rt.field.querySelectorAll(".clicked"))this.#nt.minusCount(),t.remove()}),2e3)}#Nt(){let t=Math.floor(this.#Tt/60),e=this.#Tt-60*t;this.#rt.timer.querySelector("b").innerText=`${t}:`+(e<10?"0"+e:e)}#kt(){this.#Tt=this.#gt,this.#Nt(),this.#ot.timer=setInterval((()=>{this.#Tt--,this.#Nt(),0==this.#Tt&&this.stop()}),1e3)}#xt(){for(const t in this.#ot)clearInterval(this.#ot[t])}#vt(){this.#It=0,this.#Rt()}#_t(t,e=!1){e?this.#rt[panels].classList.remove("hide"):this.#rt[panels].classList.add("hide")}#wt(t={}){for(const e in t)t[e]?this.#rt[e].classList.remove("hide"):this.#rt[e].classList.add("hide")}#Rt(){this.#rt.info.querySelector("b").innerText=this.#It}#Ft(){this.#ot.autoClick=setInterval((()=>{for(const t of this.#rt.field.querySelectorAll("*"))t.click()}),500)}#qt(){this.#rt.end.querySelector("b").innerText=this.#It,this.#rt.end.querySelector("input[name='score']").value=this.#It,null!=i.get("instagram")&&(this.#rt.end.querySelector("input[name='instagram']").value=i.get("instagram"))}#Bt(t,e=!1){t.classList.add("clicked"),t.classList.contains("bonus")&&!e&&(this.#It+=t.classList.contains("sticker")?this.#yt:1)}}(90)}))})();